"""Result types for pipeline execution."""
from dataclasses import dataclass, field
from pathlib import Path
from typing import Any, Dict, List, Optional

from nirs4all.data.dataset import SpectroDataset
from nirs4all.data.predictions import Predictions


@dataclass
class ArtifactMeta:
    """Metadata about a persisted artifact.

    Attributes:
        name: Artifact identifier (e.g., 'model', 'scaler')
        content_hash: Content-based hash for deduplication
        path: Relative path from artifacts directory
        format: Artifact format (e.g., 'joblib', 'h5', 'safetensors')
        metadata: Additional artifact metadata
    """
    name: str
    content_hash: str
    path: str
    format: str
    metadata: Dict[str, Any] = field(default_factory=dict)


@dataclass
class StepResult:
    """Result of executing a single pipeline step.

    Attributes:
        updated_context: Updated execution context after step
        artifacts: List of artifacts persisted during step execution
        predictions: Optional predictions generated by this step
    """
    updated_context: Any  # Union[Dict[str, Any], ExecutionContext]
    artifacts: List[ArtifactMeta] = field(default_factory=list)
    predictions: Optional[Predictions] = None


@dataclass
class ExecutionResult:
    """Result of executing a full pipeline on a single dataset.

    Attributes:
        predictions: Aggregated predictions from pipeline execution
        artifacts: All artifacts persisted during execution
        dataset: Final dataset state after execution
        metadata: Execution metadata (timing, pipeline info, etc.)
        pipeline_uid: Unique identifier for this pipeline execution
    """
    predictions: Predictions
    artifacts: List[ArtifactMeta]
    dataset: SpectroDataset
    metadata: Dict[str, Any]
    pipeline_uid: str


@dataclass
class OrchestrationResult:
    """Result of orchestrating multiple pipeline runs.

    Attributes:
        run_predictions: All predictions from this orchestration run
        dataset_predictions: Dict mapping dataset names to their prediction info
        execution_results: List of individual execution results
    """
    run_predictions: Predictions
    dataset_predictions: Dict[str, Dict[str, Any]]
    execution_results: List[ExecutionResult] = field(default_factory=list)
